<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <title>3~4栋住户水费详单</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        body {
            font-family: "Microsoft YaHei", Arial, sans-serif;
            padding: 10px;
            background: #f2f2f2;
            margin: 0; /* Remove default body margin */
        }
        h1 {
            font-size: 26px;
            text-align: center;
            color: #333;
            margin-bottom: 20px;
            padding-top: 10px;
        }
        .links {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
            padding: 0 10px;
        }
        .links a {
            margin: 6px;
            padding: 10px 18px;
            font-size: 18px; /* Adjusted for better mobile display */
            background-color: #007bff;
            color: white;
            border-radius: 8px;
            text-decoration: none;
            transition: background-color 0.3s ease;
            white-space: nowrap; /* Prevent wrapping in button */
        }
        .links a:hover {
            background-color: #0056b3;
        }
        h2 {
            font-size: 24px;
            margin-top: 40px; /* Adjusted margin */
            border-bottom: 2px solid #333;
            padding-bottom: 5px;
            text-align: center;
            color: #444;
            padding: 0 10px; /* Add padding for smaller screens */
        }
        .record-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            padding: 15px;
            margin: 15px 10px; /* Adjusted margin for better spacing */
            font-size: 18px; /* Adjusted for better mobile display */
            line-height: 1.5;
        }
        .fee {
            font-weight: bold;
            color: red;
            font-size: 22px; /* Adjusted for consistency */
        }
        .label {
            color: #555;
            margin-right: 5px;
            font-weight: bold; /* Make labels more prominent */
        }
        .remark {
            color: #777; /* Slightly darker gray for better readability */
            font-size: 13px; /* Slightly smaller */
            margin-top: 8px; /* More space from previous line */
            border-top: 1px dashed #eee; /* Subtle separator */
            padding-top: 8px;
        }

        /* Responsive adjustments for smaller screens */
        @media (max-width: 600px) {
            h1 {
                font-size: 22px;
            }
            .links a {
                font-size: 14px; /* Further reduced font size for mobile links */
                padding: 8px 10px; /* Adjusted padding */
                margin: 4px;
            }
            h2 {
                font-size: 20px;
                margin-top: 30px;
            }
            .record-card {
                font-size: 16px;
                padding: 12px;
                margin: 10px 5px;
            }
            .fee {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <h1>住户水费详单</h1>
    <div class="links" id="links"></div>
    <div id="content"></div>

    <script>
        const DEFAULT_WATER_PRICE = 2.8; // 普通住户水价
        const BOTTOM_SHOP_WATER_PRICE = 3.4; // 底铺水价

        fetch('https://hahagw.eu.org/data')
            .then(response => response.json())
            .then(data => {
                const linksDiv = document.getElementById('links');
                const contentDiv = document.getElementById('content');

                data.households.forEach(household => {
                    // Create household jump buttons
                    const link = document.createElement('a');
                    link.href = '#' + household.id; // Use only ID for clearer linking
                    link.textContent = household.id + '-' + household.name;
                    linksDiv.appendChild(link);

                    // Create household details section
                    const section = document.createElement('section');
                    section.id = household.id; // Use only ID for section ID
                    section.style.scrollMarginTop = '70px'; // Offset for fixed header/links if any

                    const title = document.createElement('h2');
                    title.textContent = household.id + ' - ' + household.name;
                    section.appendChild(title);

                    // Determine the correct price for the current household
                    const waterPriceForHousehold = household.id.includes('底铺') ? BOTTOM_SHOP_WATER_PRICE : DEFAULT_WATER_PRICE;

                    // Sort records by date in descending order (latest first) for display
                    household.records.sort((a, b) => new Date(b.date) - new Date(a.date));

                    // Iterate through each record
                    household.records.forEach(record => {
                        const card = document.createElement('div');
                        card.className = 'record-card';

                        // Check if it's the first record (oldest in time if sorted ascending) or only record
                        const isFirstRecord = household.records.length === 1 || record === household.records[household.records.length - 1];

                        // Usage and fee are calculated as 0 for the first/only record, or if explicitly 0
                        const displayUsage = (isFirstRecord || record.usage === undefined) ? 0 : record.usage;
                        const displayLoss = record.loss === undefined ? 0 : record.loss;
                        const displayFee = (isFirstRecord || record.fee === undefined) ? 0 : record.fee;

                        card.innerHTML = `
                            <div><span class="label">读数日期：</span>${record.date || '-'}</div>
                            <div><span class="label">水表读数(吨)：</span>${record.reading || 0}</div>
                            <div><span class="label">用水量(吨)：</span>${displayUsage}</div>
                            <div><span class="label">水损耗(吨)：</span>${displayLoss}</div>
                            <div><span class="label">水费：</span><span class="fee">${displayFee.toFixed(2)} 元</span></div>
                            <div class="remark">备注：水损耗 1 吨/月；水费 ${waterPriceForHousehold.toFixed(1)} 元/吨</div>
                        `;
                        section.appendChild(card);
                    });

                    contentDiv.appendChild(section);
                });
            })
            .catch(error => {
                document.getElementById('content').innerHTML = `<p style="color: red; text-align: center;">加载数据失败: ${error}. 请稍后再试。</p>`;
                console.error("Error fetching data:", error);
            });
    </script>
</body>
</html>
